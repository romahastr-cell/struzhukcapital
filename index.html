<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>СТРАТЕГИЯ КАПИТАЛА — калькулятор (Pro + Light)</title>
<style>
:root{
  --bg:#ffffff; --text:#0b1220; --muted:#475569; --border:#e5e7eb;
  --accent:#6D28D9; --accent-dark:#5a20b9;
}
*{box-sizing:border-box}
body{margin:0;background:#fff;color:var(--text);font:15px/1.55 Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif}
a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}
header{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid var(--border)}
.wrap-header{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:14px 18px}
.brand{display:flex;align-items:center;gap:12px}
.brand img{width:56px;height:56px;border-radius:10px;object-fit:cover}
.brand h1{margin:0;font-size:20px}
.author a{color:var(--text)} .author a:hover{color:var(--accent)}
.cta a{display:inline-block;padding:8px 12px;border:1px solid var(--accent);border-radius:10px;background:rgba(109,40,217,.06);font-weight:700}
.subline{padding:8px 18px 12px;border-top:1px solid var(--border);background:#fff}
.subline a{display:block;text-align:center;font-weight:800;color:var(--text);border:1px solid var(--accent);border-radius:12px;padding:10px;background:rgba(109,40,217,.05)}
main{max-width:1100px;margin:20px auto;padding:0 16px}
.tabs{display:flex;gap:8px;margin-bottom:12px}
.tab-btn{padding:10px 14px;border:2px solid var(--accent);border-radius:12px;background:#fff;color:var(--text);font-weight:800;cursor:pointer}
.tab-btn.active{background:var(--accent);color:#fff}
.card{background:#fff;border:2px solid var(--accent);border-radius:16px;padding:16px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
label{display:block;margin:8px 0 6px;font-weight:700}
input,select{width:100%;padding:12px;border-radius:10px;border:1px solid var(--border);background:#fff;color:var(--text);font-size:15px}
input:focus,select:focus{border-color:var(--accent);outline:none;box-shadow:0 0 0 3px rgba(109,40,217,.1)}
.btn{padding:12px 14px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-weight:800;cursor:pointer}
.btn:hover{background:var(--accent-dark)}
.btn.ghost{background:#fff;color:var(--text);border:2px solid var(--accent)}
.grid4{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:12px}
.kpi{border:2px solid var(--accent);border-radius:16px;padding:12px;background:#fff}
.kpi .label{color:var(--muted);font-size:13px} .kpi .value{font-size:22px;font-weight:900}
.chart-wrap{margin-top:14px;border:2px solid var(--accent);border-radius:16px;padding:12px;background:#fff}
canvas{width:100% !important;height:360px !important;background:#fff;border:1px dashed var(--border);border-radius:12px}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{border-bottom:1px solid var(--border);padding:8px 10px;text-align:right;font-variant-numeric:tabular-nums}
th:first-child,td:first-child,th:nth-child(2),td:nth-child(2){text-align:left}
.section-title{font-weight:900;margin:4px 0 10px}
.pro,.light{display:none} .visible{display:block}
footer{margin:30px 0;padding:16px;border-top:1px solid var(--border)}
.footer-flex{display:flex;align-items:center;gap:16px;flex-wrap:wrap}
.footer-flex img.portrait{width:120px;height:120px;border-radius:12px;object-fit:cover}
.icon-link{display:flex;align-items:center;gap:8px;padding:10px 12px;border:1px solid var(--border);border-radius:12px}
.icon-link svg{width:20px;height:20px}
@media(max-width:900px){.row,.row3{grid-template-columns:1fr} .grid4{grid-template-columns:1fr 1fr}}
</style>
</head>
<body>
<header>
  <div class="wrap-header">
    <div class="brand">
      <img src="logo.jpg" alt="логотип">
      <div>
        <h1>СТРАТЕГИЯ КАПИТАЛА</h1>
        <div class="author"><a href="https://t.me/rstruzhuk" target="_blank">автор Roman Struzhuk · @rstruzhuk</a></div>
      </div>
    </div>
    <p class="cta"><a href="https://t.me/Struzhukcapital" target="_blank">Хочешь понимать, как делать больше 50% годовых? Вступай в канал</a></p>
  </div>
  <div class="subline"><a href="https://t.me/Struzhukcapital" target="_blank">Хочешь научиться зарабатывать больше 60% годовых? Переходи в канал</a></div>
</header>

<main>
  <div class="tabs">
    <button class="tab-btn active" data-tab="pro">Калькулятор PRO</button>
    <button class="tab-btn" data-tab="light">Калькулятор LIGHT</button>
  </div>

  <!-- PRO -->
  <section class="pro visible">
    <div class="card">
      <div class="section-title">Параметры</div>
      <div class="row3">
        <div><label>Стартовый капитал</label><input id="startCapital" type="number" value="0" min="0" step="0.01" inputmode="decimal"></div>
        <div><label>Ежемесячный взнос</label><input id="monthlyContribution" type="number" value="100000" min="0" step="0.01" inputmode="decimal"></div>
        <div><label>Срок, лет</label><input id="years" type="number" value="10" min="1" max="60" step="1" inputmode="numeric"></div>
      </div>
      <div class="row">
        <div>
          <label>Тип годовой ставки</label>
          <select id="annualType"><option value="nominal" selected>Номинальная</option><option value="effective">Эффективная</option></select>
          <div class="muted">Номинальная — указанная годовая без учета периода начисления. Эффективная — реальная годовая с учетом капитализации.</div>
        </div>
        <div><label>Годовая ставка, %</label><input id="annualRate" type="number" value="50" step="0.0001" inputmode="decimal"></div>
      </div>
      <div class="row">
        <div><label>Месячная ставка, % (override)</label><input id="monthlyRate" type="number" placeholder="оставь пустым" inputmode="decimal"><div class="muted">Если заполнить — пересиливает годовую. Фиксированная месячная доходность.</div></div>
        <div><label>Дневная ставка, % (override)</label><input id="dailyRate" type="number" placeholder="оставь пустым" inputmode="decimal"><div class="muted">Если заполнить — берём как дневную. Месячная/годовая пересчитаются.</div></div>
      </div>
      <div class="row">
        <div><label>Капитализация</label><select id="compounding"><option value="monthly" selected>Ежемесячно</option><option value="daily">Ежедневно</option></select><div class="muted">Ежемесячная — проценты раз в месяц. Ежедневная — каждый день.</div></div>
        <div><label>Реинвестирование</label><select id="reinvest"><option value="yes" selected>проценты в капитал</option><option value="no">проценты выводить</option></select><div class="muted">Реинвест — проценты добавляются к капиталу.</div></div>
      </div>
      <div class="row" style="margin-top:10px;"><button class="btn" id="runBtn">Рассчитать</button><button class="btn ghost" id="exportCsvBtn">Экспорт CSV</button></div>
    </div>

    <div class="grid4">
      <div class="kpi"><div class="label">Баланс к концу периода</div><div id="finalSum" class="value">0 ₽</div></div>
      <div class="kpi"><div class="label">Всего внесено</div><div id="totalDeposits" class="value">0 ₽</div></div>
      <div class="kpi"><div class="label">Получено процентов</div><div id="totalInterest" class="value">0 ₽</div></div>
      <div class="kpi"><div class="label">Эффективная годовая</div><div id="effApr" class="value">0%</div></div>
    </div>

    <div class="chart-wrap">
      <div class="section-title">Итоги по годам</div>
      <canvas id="chartPro" width="1000" height="360"></canvas>
    </div>

    <div class="card" style="margin-top:12px;">
      <div class="section-title">Помесячная таблица</div>
      <div style="max-height:420px; overflow:auto; border:1px solid var(--border); border-radius:12px;">
        <table id="table">
          <thead><tr><th>#</th><th>Период</th><th>Взнос, ₽</th><th>Проценты за период, ₽</th><th>Баланс, ₽</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- LIGHT -->
  <section class="light">
    <div class="card">
      <div class="section-title">Калькулятор ежедневных сложных процентов</div>
      <div class="row3">
        <div><label>Начальное значение, ₽</label><input id="light_initial" type="number" value="100000" min="0" step="0.01" inputmode="decimal"></div>
        <div>
          <label>Процентная ставка</label>
          <div class="row">
            <input id="light_rate" type="number" value="1" step="0.0001" inputmode="decimal">
            <select id="light_rate_unit"><option value="daily" selected>% в день</option><option value="monthly">% в месяц</option><option value="annual">% в год</option></select>
          </div>
        </div>
        <div><label>Время</label><div class="row"><input id="light_days" type="number" value="365" min="1" step="1" inputmode="numeric"><div style="display:flex;align-items:center;padding-left:8px;">дней</div></div></div>
      </div>
      <div style="margin-top:10px;"><button class="btn" id="light_calc">Рассчитать</button></div>
    </div>

    <div class="grid4">
      <div class="kpi"><div class="label">Расчет ваших инвестиций</div><div id="light_future" class="value">0 ₽</div></div>
      <div class="kpi"><div class="label">Общая сумма процентов</div><div id="light_interest_total" class="value">0 ₽</div></div>
    </div>

    <div class="card" style="margin-top:12px;">
      <div class="section-title">Баланс по дням</div>
      <div style="max-height:420px; overflow:auto; border:1px solid var(--border); border-radius:12px;">
        <table id="light_table">
          <thead><tr><th>День</th><th>Баланс, ₽</th><th>Заработанные проценты, ₽</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>
</main>

<footer>
  <div class="footer-flex">
    <img class="portrait" src="roman.jpg" alt="Roman Struzhuk">
    <a class="icon-link" href="https://instagram.com/rstruzhuk" target="_blank" title="Instagram">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="3" width="18" height="18" rx="5" ry="5" stroke-width="2"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" stroke-width="2"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5" stroke-width="2"/></svg>
      <span>@rstruzhuk</span>
    </a>
    <a class="icon-link" href="https://t.me/Struzhukcapital" target="_blank" title="Стратегия капитала">
      <img src="logo.jpg" alt="СК" style="width:20px;height:20px;border-radius:4px;object-fit:cover;">
      <span>Канал «Стратегия капитала»</span>
    </a>
    <a class="icon-link" href="https://t.me/rstruzhuk" target="_blank" title="Telegram">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M22 2L11 13" stroke-width="2"/><path d="M22 2l-7 20-4-9-9-4 20-7z" stroke-width="2"/></svg>
      <span>@rstruzhuk</span>
    </a>
  </div>
</footer>

<script>
const $ = (id)=>document.getElementById(id);
const fmt = (n)=>{ const num=Number(n); if(!isFinite(num)) return '0'; try{return num.toLocaleString('ru-RU',{maximumFractionDigits:2});}catch(e){return String(Math.round(num*100)/100).replace(/\B(?=(\d{3})+(?!\d))/g,' ');} };

// вкладки
const tabs=document.querySelectorAll('.tab-btn'); const proSec=document.querySelector('.pro'); const lightSec=document.querySelector('.light');
tabs.forEach(b=>b.addEventListener('click',()=>{ tabs.forEach(x=>x.classList.remove('active')); b.classList.add('active'); if(b.dataset.tab==='pro'){ proSec.classList.add('visible'); lightSec.classList.remove('visible'); } else { lightSec.classList.add('visible'); proSec.classList.remove('visible'); }}));

// пересчёт ставок для PRO
function getRates(){
  const annualType = $('annualType').value;
  const annualRate = parseFloat(($('annualRate').value||'0').replace(',','.'))/100;
  const mOverride = parseFloat(($('monthlyRate').value||'').replace(',','.'));
  const dOverride = parseFloat(($('dailyRate').value||'').replace(',','.'));
  let rM, rD, rEff;
  if(!isNaN(mOverride)){ rM=mOverride/100; rD=Math.pow(1+rM,1/30)-1; rEff=Math.pow(1+rM,12)-1; }
  else if(!isNaN(dOverride)){ rD=dOverride/100; rM=Math.pow(1+rD,30)-1; rEff=Math.pow(1+rD,365)-1; }
  else { if(annualType==='nominal'){ rM=annualRate/12; rD=annualRate/365; rEff=Math.pow(1+rM,12)-1; } else { rEff=annualRate; rM=Math.pow(1+rEff,1/12)-1; rD=Math.pow(1+rEff,1/365)-1; } }
  return { rM, rD, rEff };
}

// симуляция PRO
function simulatePro(){
  const startCapital = parseFloat(($('startCapital').value||'0').replace(',','.'));
  const P = parseFloat(($('monthlyContribution').value||'0').replace(',','.'));
  const years = Math.max(1, parseInt($('years').value||'10',10));
  const comp = $('compounding').value; const reinvest = $('reinvest').value==='yes';
  const { rM, rD } = getRates();

  let capital = startCapital, interestPayout = 0, totalDeposits = startCapital;
  const start = new Date(); start.setHours(0,0,0,0); start.setDate(1);
  const end = new Date(start); end.setFullYear(end.getFullYear()+years);

  let rows=[]; let idx=0; let yearLabels=[], yearData=[];

  function pushRow(label, dep, intr, bal){ rows.push({idx:++idx,label,deposit:dep||0,interest:intr||0,balance:bal||0}); }

  if (comp==='monthly') {
    let d = new Date(start);
    while (d < end) {
      const label = new Date(d.getFullYear(), d.getMonth(), 1).toLocaleDateString('ru-RU', {year:'numeric', month:'2-digit'});
      capital += P; totalDeposits += P;
      const intr = capital * (isFinite(rM)?rM:0);
      if (reinvest) capital += intr; else interestPayout += intr;
      pushRow(label, P, intr, capital);
      const next = new Date(d.getFullYear(), d.getMonth()+1, 1);
      if (next.getFullYear()!==d.getFullYear()) { yearLabels.push(String(d.getFullYear())); yearData.push(capital); }
      d = next;
    }
  } else {
    let d=new Date(start); let month=d.getMonth(); let intr=0, dep=0;
    while(d<end){
      if(d.getDate()===1){ capital += P; totalDeposits += P; dep += P; }
      const interest = capital * (isFinite(rD)?rD:0);
      if(reinvest) capital += interest; else interestPayout += interest;
      intr += interest;
      const next=new Date(d); next.setDate(d.getDate()+1);
      if (next.getMonth()!==month) {
        const label=new Date(d.getFullYear(), d.getMonth(), 1).toLocaleDateString('ru-RU',{year:'numeric',month:'2-digit'});
        pushRow(label, dep, intr, capital); dep=0; intr=0;
        if (next.getFullYear()!==d.getFullYear()) { yearLabels.push(String(d.getFullYear())); yearData.push(capital); }
        month=next.getMonth();
      }
      d=next;
    }
  }

  // таблица
  const tbody=document.querySelector('#table tbody'); tbody.innerHTML='';
  rows.forEach(r=>{ 
    const tr=document.createElement('tr'); 
    tr.innerHTML='<td>'+r.idx+'</td><td>'+r.label+'</td><td>'+fmt(r.deposit)+'</td><td>'+fmt(r.interest)+'</td><td>'+fmt(r.balance)+'</td>';
    tbody.appendChild(tr); 
  });

  // KPI
  const finalSum=capital, totDep=totalDeposits, totInt= reinvest ? (finalSum - totDep) : interestPayout;
  $('finalSum').textContent = fmt(finalSum) + ' ₽';
  $('totalDeposits').textContent = fmt(totDep) + ' ₽';
  $('totalInterest').textContent = fmt(totInt) + ' ₽';
  $('effApr').textContent = ((Math.pow(1 + (isFinite(getRates().rM)?getRates().rM:0), 12) - 1)*100).toFixed(2) + '%';

  drawYearBars('chartPro', yearLabels, yearData);
}

// рисуем «свечи»-столбики
function drawYearBars(id, labels, data){
  const c=document.getElementById(id), ctx=c.getContext('2d'), W=c.width, H=c.height;
  ctx.clearRect(0,0,W,H);
  const pad=40, x0=pad, y0=H-pad, x1=W-pad, y1=20;
  ctx.strokeStyle='#cbd5e1'; ctx.lineWidth=1; ctx.beginPath(); ctx.moveTo(x0,y0); ctx.lineTo(x0,y1); ctx.lineTo(x1,y1); ctx.stroke();
  if(!data.length) return;
  const max=Math.max(...data)*1.1 || 1; const n=data.length; const bw=(x1-x0)/(n*1.4); const gap=bw*0.4;
  ctx.fillStyle='#64748b'; ctx.font='12px Inter,system-ui,sans-serif';
  for(let i=0;i<=5;i++){ const t=i/5; const y=y0-(y0-y1)*t; const val=max*t;
    ctx.strokeStyle='rgba(2,6,23,.08)'; ctx.beginPath(); ctx.moveTo(x0,y); ctx.lineTo(x1,y); ctx.stroke();
    ctx.fillText(fmt(val),4,y+4);
  }
  for(let i=0;i<n;i++){ const v=data[i]; const x=x0+i*(bw+gap)+gap; const h=(v/max)*(y0-y1); const y=y0-h;
    ctx.fillStyle='#6D28D933'; ctx.strokeStyle='#6D28D9'; ctx.lineWidth=2;
    ctx.fillRect(x,y,bw,h); ctx.strokeRect(x,y,bw,h);
    ctx.fillStyle='#0b1220'; ctx.textAlign='center';
    ctx.fillText(fmt(v)+' ₽', x+bw/2, y-6);
    ctx.fillText(labels[i], x+bw/2, y0+14);
    ctx.textAlign='start';
  }
}

// LIGHT (ежедневная капитализация)
function toDailyRate(value, unit){
  const r = parseFloat(String(value).replace(',','.'))/100;
  if (!isFinite(r) || r<0) return 0;
  if (unit==='daily') return r;
  if (unit==='monthly') return Math.pow(1+r, 1/30)-1;
  if (unit==='annual') return Math.pow(1+r, 1/365)-1;
  return 0;
}
function calcLight(){
  const P=parseFloat(($('light_initial').value||'0').replace(',','.'));
  const rate=parseFloat(($('light_rate').value||'0').replace(',','.'));
  const unit=$('light_rate_unit').value;
  const days=Math.max(1, parseInt(($('light_days').value||'1'),10));
  const rD=toDailyRate(rate, unit);
  let balance=P, totalInterest=0;
  const tbody=document.querySelector('#light_table tbody'); tbody.innerHTML='';
  // День 1 — исходная сумма
  let tr0=document.createElement('tr'); tr0.innerHTML='<td>1</td><td>'+fmt(balance)+'</td><td>0</td>'; tbody.appendChild(tr0);
  for(let d=2; d<=days; d++){
    const interest=balance*rD;
    balance+=interest; totalInterest+=interest;
    const tr=document.createElement('tr'); tr.innerHTML='<td>'+d+'</td><td>'+fmt(balance)+'</td><td>'+fmt(interest)+'</td>'; tbody.appendChild(tr);
  }
  $('light_future').textContent = fmt(balance) + ' ₽';
  $('light_interest_total').textContent = fmt(totalInterest) + ' ₽';
}

// wire
document.getElementById('runBtn').addEventListener('click', simulatePro);
document.getElementById('exportCsvBtn').addEventListener('click', ()=>{
  const rows=[...document.querySelectorAll('#table tbody tr')].map(tr=>[...tr.children].map(td=>td.textContent));
  const header=['#','Период','Взнос, ₽','Проценты за период, ₽','Баланс, ₽'];
  const blob=new Blob([[header.join(';')].concat(rows.map(r=>r.join(';'))).join('\n')],{type:'text/csv;charset=utf-8;'});
  const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='strategy_capital_pro.csv'; a.click(); URL.revokeObjectURL(url);
});
document.getElementById('light_calc').addEventListener('click', calcLight);

// первый рендер
simulatePro(); calcLight();
</script>
</body>
</html>
